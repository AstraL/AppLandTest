{"version":"1.2","metadata":{"language":{"name":"ruby","engine":"ruby","version":"2.6.2"},"client":{"name":"appmap","url":"https://github.com/applandinc/appmap-ruby","version":"0.26.1"},"frameworks":[{"name":"rails","version":"6.0.3.1"},{"name":"rspec","version":"3.9.2"}],"git":{"repository":"git@github.com:applandinc/discourse.git","branch":"master","commit":"32fd4b3aab495794a8b45d85fb5cca2201161e3c","status":["M Gemfile.lock","M config/initializers/150-appmap.rb","D spec/requests/posts_controller_spec.rb","M spec/requests/user_actions_controller_spec.rb","M spec/requests/users_controller_spec.rb"],"git_last_annotated_tag":"v2.5.0.beta5","git_last_tag":"v2.5.0.beta5","git_commits_since_last_annotated_tag":0,"git_commits_since_last_tag":0},"name":"UsersController #search_users groups when signed in doesn't search for groups","app":"Discourse","feature":"UsersController #search_users","feature_group":"Users","recorder":{"name":"rspec"}},"classMap":[{"name":"app/models","type":"package","children":[{"name":"LocaleSiteSetting","type":"class","children":[{"name":"fallback_locale","type":"function","location":"app/models/locale_site_setting.rb:62","static":true}]},{"name":"UserAuthToken(id: integer, user_id: integer, auth_token: string, prev_auth_token: string, user_agent: string, auth_token_seen: boolean, client_ip: inet, rotated_at: datetime, created_at: datetime, updated_at: datetime, seen_at: datetime)","type":"class","children":[{"name":"lookup","type":"function","location":"app/models/user_auth_token.rb:99","static":true},{"name":"hash_token","type":"function","location":"app/models/user_auth_token.rb:164","static":true},{"name":"log","type":"function","location":"app/models/user_auth_token.rb:26","static":true}]},{"name":"GlobalSetting","type":"class","children":[{"name":"safe_secret_key_base","type":"function","location":"app/models/global_setting.rb:25","static":true}]},{"name":"User","type":"class","children":[{"name":"suspended?","type":"function","location":"app/models/user.rb:869","static":false},{"name":"update_last_seen!","type":"function","location":"app/models/user.rb:721","static":false},{"name":"update_visit_record!","type":"function","location":"app/models/user.rb:680","static":false},{"name":"visit_record_for","type":"function","location":"app/models/user.rb:676","static":false},{"name":"create_visit_record!","type":"function","location":"app/models/user.rb:671","static":false},{"name":"seen_before?","type":"function","location":"app/models/user.rb:667","static":false},{"name":"update_ip_address!","type":"function","location":"app/models/user.rb:715","static":false},{"name":"effective_locale","type":"function","location":"app/models/user.rb:321","static":false}]},{"name":"UserSearch","type":"class","children":[{"name":"search","type":"function","location":"app/models/user_search.rb:169","static":false},{"name":"search_ids","type":"function","location":"app/models/user_search.rb:71","static":false},{"name":"scoped_users","type":"function","location":"app/models/user_search.rb:24","static":false},{"name":"filtered_by_term_users","type":"function","location":"app/models/user_search.rb:51","static":false}]},{"name":"Roleable","type":"class","children":[{"name":"staff?","type":"function","location":"app/models/concerns/roleable.rb:13","static":false}]},{"name":"ApplicationRequest(id: integer, date: date, req_type: integer, count: integer)","type":"class","children":[{"name":"increment!","type":"function","location":"app/models/application_request.rb:26","static":true}]}]},{"name":"app/controllers","type":"package","children":[{"name":"ApplicationController","type":"class","children":[{"name":"handle_theme","type":"function","location":"app/controllers/application_controller.rb:388","static":false},{"name":"resolve_safe_mode","type":"function","location":"app/controllers/application_controller.rb:377","static":false},{"name":"guardian","type":"function","location":"app/controllers/application_controller.rb:423","static":false},{"name":"set_current_user_for_logs","type":"function","location":"app/controllers/application_controller.rb:294","static":false},{"name":"clear_notifications","type":"function","location":"app/controllers/application_controller.rb:302","static":false},{"name":"set_locale","type":"function","location":"app/controllers/application_controller.rb:328","static":false},{"name":"set_mobile_view","type":"function","location":"app/controllers/application_controller.rb:368","static":false},{"name":"requires_login_arg","type":"function","location":"app/controllers/application_controller.rb:669","static":true},{"name":"preload_json","type":"function","location":"app/controllers/application_controller.rb:352","static":false},{"name":"conditionally_allow_site_embedding","type":"function","location":"app/controllers/application_controller.rb:92","static":false},{"name":"dont_cache_page","type":"function","location":"app/controllers/application_controller.rb:85","static":false},{"name":"perform_refresh_session","type":"function","location":"app/controllers/application_controller.rb:75","static":false}]},{"name":"UsersController","type":"class","children":[{"name":"search_users","type":"function","location":"app/controllers/users_controller.rb:923","static":false}]}]},{"name":"lib/auth","type":"package","children":[{"name":"Auth","type":"class","children":[{"name":"DefaultCurrentUserProvider","type":"class","children":[{"name":"current_user","type":"function","location":"lib/auth/default_current_user_provider.rb:61","static":false},{"name":"should_update_last_seen?","type":"function","location":"lib/auth/default_current_user_provider.rb:286","static":false},{"name":"is_api?","type":"function","location":"lib/auth/default_current_user_provider.rb:271","static":false},{"name":"refresh_session","type":"function","location":"lib/auth/default_current_user_provider.rb:173","static":false},{"name":"is_user_api?","type":"function","location":"lib/auth/default_current_user_provider.rb:276","static":false},{"name":"has_auth_cookie?","type":"function","location":"lib/auth/default_current_user_provider.rb:281","static":false}]}]}]},{"name":"lib/guardian","type":"package","children":[{"name":"Guardian","type":"class","children":[{"name":"can_enable_safe_mode?","type":"function","location":"lib/guardian.rb:149","static":false},{"name":"allow_themes?","type":"function","location":"lib/guardian.rb:474","static":false}]}]}],"events":[{"id":752255,"event":"call","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parameters":[{"name":"locale","class":"Symbol","object_id":70097724306540,"value":"en_US","kind":"req"}],"receiver":{"class":"Class","object_id":70097569845280,"value":"LocaleSiteSetting"}},{"id":752256,"event":"return","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parent_id":752255,"elapsed":7.0e-06,"return_value":{"class":"Symbol","value":"en","object_id":3894428}},{"id":752257,"event":"call","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parameters":[{"name":"locale","class":"Symbol","object_id":3894428,"value":"en","kind":"req"}],"receiver":{"class":"Class","object_id":70097569845280,"value":"LocaleSiteSetting"}},{"id":752258,"event":"return","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parent_id":752257,"elapsed":1.1e-05},{"id":752259,"event":"call","defined_class":"AppMap::Rails::ActionHandler::HTTPServerRequest","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/action_handler.rb","lineno":50,"static":false,"thread_id":70097708498960,"http_server_request":{"request_method":"GET","path_info":"/u/search/users.json?include_mentionable_groups=false&include_messageable_groups=false&term=a"},"message":[{"name":"include_mentionable_groups","class":"String","value":"false","object_id":70097804132000},{"name":"include_messageable_groups","class":"String","value":"false","object_id":70097804127700},{"name":"term","class":"String","value":"a","object_id":70097804164200},{"name":"controller","class":"String","value":"users","object_id":70097758363800},{"name":"action","class":"String","value":"search_users","object_id":70097758363780},{"name":"format","class":"String","value":"json","object_id":70097803819740}]},{"id":752260,"event":"call","defined_class":"ApplicationController","method_id":"handle_theme","path":"app/controllers/application_controller.rb","lineno":388,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752261,"event":"call","defined_class":"ApplicationController","method_id":"resolve_safe_mode","path":"app/controllers/application_controller.rb","lineno":377,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752262,"event":"call","defined_class":"ApplicationController","method_id":"guardian","path":"app/controllers/application_controller.rb","lineno":423,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752263,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752264,"event":"call","defined_class":"UserAuthToken(id: integer, user_id: integer, auth_token: string, prev_auth_token: string, user_agent: string, auth_token_seen: boolean, client_ip: inet, rotated_at: datetime, created_at: datetime, updated_at: datetime, seen_at: datetime)","method_id":"lookup","path":"app/models/user_auth_token.rb","lineno":99,"static":true,"thread_id":70097708498960,"parameters":[{"name":"unhashed_token","class":"String","object_id":70097825968220,"value":"a375fff0e68d886e7874e62f14353c29","kind":"req"},{"name":"opts","class":"Hash","object_id":70097825965040,"value":"{:seen=>true, :user_agent=>nil, :path=>nil, :client_ip=>\"127.0.0.1\"}","kind":"opt"}],"receiver":{"class":"Class","object_id":70097712007000,"value":"UserAuthToken"}},{"id":752265,"event":"call","defined_class":"UserAuthToken(id: integer, user_id: integer, auth_token: string, prev_auth_token: string, user_agent: string, auth_token_seen: boolean, client_ip: inet, rotated_at: datetime, created_at: datetime, updated_at: datetime, seen_at: datetime)","method_id":"hash_token","path":"app/models/user_auth_token.rb","lineno":164,"static":true,"thread_id":70097708498960,"parameters":[{"name":"token","class":"String","object_id":70097825968220,"value":"a375fff0e68d886e7874e62f14353c29","kind":"req"}],"receiver":{"class":"Class","object_id":70097712007000,"value":"UserAuthToken"}},{"id":752266,"event":"call","defined_class":"GlobalSetting","method_id":"safe_secret_key_base","path":"app/models/global_setting.rb","lineno":25,"static":true,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"Class","object_id":70097703221560,"value":"GlobalSetting"}},{"id":752267,"event":"return","defined_class":"GlobalSetting","method_id":"safe_secret_key_base","path":"app/models/global_setting.rb","lineno":25,"static":true,"thread_id":70097708498960,"parent_id":752266,"elapsed":9.0e-06,"return_value":{"class":"String","value":"9a861fe75a448752d4997880bb647b45e1a210a880a56024d1dc12cdd3fa29354dc83c1a5e3ff086d25ac9454040e6f43418","object_id":70097709303360}},{"id":752268,"event":"return","defined_class":"UserAuthToken(id: integer, user_id: integer, auth_token: string, prev_auth_token: string, user_agent: string, auth_token_seen: boolean, client_ip: inet, rotated_at: datetime, created_at: datetime, updated_at: datetime, seen_at: datetime)","method_id":"hash_token","path":"app/models/user_auth_token.rb","lineno":164,"static":true,"thread_id":70097708498960,"parent_id":752265,"elapsed":0.000131,"return_value":{"class":"String","value":"NGCKvtOMZCLvsgPtUjt1dvIiWys=","object_id":70097730638800}},{"id":752269,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"SELECT \"user_auth_tokens\".* FROM \"user_auth_tokens\" WHERE ((auth_token = 'NGCKvtOMZCLvsgPtUjt1dvIiWys=' OR\n                          prev_auth_token = 'NGCKvtOMZCLvsgPtUjt1dvIiWys=') AND rotated_at > '2020-03-29 18:58:08.480158') LIMIT 1","database_type":"postgres","server_version":110006}},{"id":752270,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752269,"elapsed":0.001247},{"id":752271,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"UPDATE \"user_auth_tokens\" SET \"auth_token_seen\" = TRUE, \"seen_at\" = '2020-05-28 18:58:08.485641' WHERE \"user_auth_tokens\".\"id\" = 900 AND \"user_auth_tokens\".\"auth_token\" = 'NGCKvtOMZCLvsgPtUjt1dvIiWys='","database_type":"postgres","server_version":110006}},{"id":752272,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752271,"elapsed":0.001123},{"id":752273,"event":"call","defined_class":"UserAuthToken(id: integer, user_id: integer, auth_token: string, prev_auth_token: string, user_agent: string, auth_token_seen: boolean, client_ip: inet, rotated_at: datetime, created_at: datetime, updated_at: datetime, seen_at: datetime)","method_id":"log","path":"app/models/user_auth_token.rb","lineno":26,"static":true,"thread_id":70097708498960,"parameters":[{"name":"info","class":"Hash","object_id":70097826375820,"value":"{:action=>\"seen token\", :user_auth_token_id=>900, :user_id=>989, :auth_token=>\"NGCKvtOMZCLvsgPtUjt1d","kind":"req"}],"receiver":{"class":"Class","object_id":70097712007000,"value":"UserAuthToken"}},{"id":752274,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"SAVEPOINT active_record_2","database_type":"postgres","server_version":110006}},{"id":752275,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752274,"elapsed":0.000871},{"id":752276,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"INSERT INTO \"user_auth_token_logs\" (\"action\", \"user_auth_token_id\", \"user_id\", \"client_ip\", \"auth_token\", \"created_at\") VALUES ('seen token', 900, 989, '127.0.0.1/32', 'NGCKvtOMZCLvsgPtUjt1dvIiWys=', '2020-05-28 18:58:08.494621') RETURNING \"id\"","database_type":"postgres","server_version":110006}},{"id":752277,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752276,"elapsed":0.000981},{"id":752278,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"RELEASE SAVEPOINT active_record_2","database_type":"postgres","server_version":110006}},{"id":752279,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752278,"elapsed":0.000816},{"id":752280,"event":"return","defined_class":"UserAuthToken(id: integer, user_id: integer, auth_token: string, prev_auth_token: string, user_agent: string, auth_token_seen: boolean, client_ip: inet, rotated_at: datetime, created_at: datetime, updated_at: datetime, seen_at: datetime)","method_id":"log","path":"app/models/user_auth_token.rb","lineno":26,"static":true,"thread_id":70097708498960,"parent_id":752273,"elapsed":0.013371,"return_value":{"class":"UserAuthTokenLog","value":"#<UserAuthTokenLog:0x00007f81d81598f0>","object_id":70097826401400}},{"id":752281,"event":"return","defined_class":"UserAuthToken(id: integer, user_id: integer, auth_token: string, prev_auth_token: string, user_agent: string, auth_token_seen: boolean, client_ip: inet, rotated_at: datetime, created_at: datetime, updated_at: datetime, seen_at: datetime)","method_id":"lookup","path":"app/models/user_auth_token.rb","lineno":99,"static":true,"thread_id":70097708498960,"parent_id":752264,"elapsed":0.023948,"return_value":{"class":"UserAuthToken","value":"#<UserAuthToken:0x00007f81cb7c0390>","object_id":70097720705480}},{"id":752282,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"SELECT \"users\".* FROM \"users\" WHERE \"users\".\"id\" = 989 LIMIT 1","database_type":"postgres","server_version":110006}},{"id":752283,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752282,"elapsed":0.001221},{"id":752284,"event":"call","defined_class":"User","method_id":"suspended?","path":"app/models/user.rb","lineno":869,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"User","object_id":70097817224740,"value":"#<User:0x00007f81d6fd8c48>"}},{"id":752285,"event":"return","defined_class":"User","method_id":"suspended?","path":"app/models/user.rb","lineno":869,"static":false,"thread_id":70097708498960,"parent_id":752284,"elapsed":1.7e-05},{"id":752286,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"should_update_last_seen?","path":"lib/auth/default_current_user_provider.rb","lineno":286,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752287,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"should_update_last_seen?","path":"lib/auth/default_current_user_provider.rb","lineno":286,"static":false,"thread_id":70097708498960,"parent_id":752286,"elapsed":0.000863,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":752288,"event":"call","defined_class":"User","method_id":"update_last_seen!","path":"app/models/user.rb","lineno":721,"static":false,"thread_id":70097708498960,"parameters":[{"name":"now","class":"NilClass","object_id":8,"value":null,"kind":"opt"}],"receiver":{"class":"User","object_id":70097817224740,"value":"#<User:0x00007f81d6fd8c48>"}},{"id":752289,"event":"call","defined_class":"User","method_id":"update_visit_record!","path":"app/models/user.rb","lineno":680,"static":false,"thread_id":70097708498960,"parameters":[{"name":"date","class":"Date","object_id":70097817273920,"value":"2020-05-28","kind":"req"}],"receiver":{"class":"User","object_id":70097817224740,"value":"#<User:0x00007f81d6fd8c48>"}},{"id":752290,"event":"call","defined_class":"User","method_id":"visit_record_for","path":"app/models/user.rb","lineno":676,"static":false,"thread_id":70097708498960,"parameters":[{"name":"date","class":"Date","object_id":70097817273920,"value":"2020-05-28","kind":"req"}],"receiver":{"class":"User","object_id":70097817224740,"value":"#<User:0x00007f81d6fd8c48>"}},{"id":752291,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"SELECT \"user_visits\".* FROM \"user_visits\" WHERE \"user_visits\".\"user_id\" = 989 AND \"user_visits\".\"visited_at\" = '2020-05-28' LIMIT 1","database_type":"postgres","server_version":110006}},{"id":752292,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752291,"elapsed":0.000997},{"id":752293,"event":"return","defined_class":"User","method_id":"visit_record_for","path":"app/models/user.rb","lineno":676,"static":false,"thread_id":70097708498960,"parent_id":752290,"elapsed":0.004892},{"id":752294,"event":"call","defined_class":"User","method_id":"create_visit_record!","path":"app/models/user.rb","lineno":671,"static":false,"thread_id":70097708498960,"parameters":[{"name":"date","class":"Date","object_id":70097817273920,"value":"2020-05-28","kind":"req"},{"name":"opts","class":"NilClass","object_id":8,"value":null,"kind":"opt"}],"receiver":{"class":"User","object_id":70097817224740,"value":"#<User:0x00007f81d6fd8c48>"}},{"id":752295,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"SELECT \"user_stats\".\"user_id\", \"user_stats\".\"topics_entered\", \"user_stats\".\"time_read\", \"user_stats\".\"days_visited\", \"user_stats\".\"posts_read_count\", \"user_stats\".\"likes_given\", \"user_stats\".\"likes_received\", \"user_stats\".\"new_since\", \"user_stats\".\"read_faq\", \"user_stats\".\"first_post_created_at\", \"user_stats\".\"post_count\", \"user_stats\".\"topic_count\", \"user_stats\".\"bounce_score\", \"user_stats\".\"reset_bounce_score_after\", \"user_stats\".\"flags_agreed\", \"user_stats\".\"flags_disagreed\", \"user_stats\".\"flags_ignored\", \"user_stats\".\"first_unread_at\", \"user_stats\".\"distinct_badge_count\" FROM \"user_stats\" WHERE \"user_stats\".\"user_id\" = 989 LIMIT 1","database_type":"postgres","server_version":110006}},{"id":752296,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752295,"elapsed":0.001062},{"id":752297,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"UPDATE \"user_stats\" SET \"days_visited\" = 1 WHERE \"user_stats\".\"user_id\" = 989","database_type":"postgres","server_version":110006}},{"id":752298,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752297,"elapsed":0.000918},{"id":752299,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"SAVEPOINT active_record_2","database_type":"postgres","server_version":110006}},{"id":752300,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752299,"elapsed":0.000832},{"id":752301,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"INSERT INTO \"user_visits\" (\"user_id\", \"visited_at\") VALUES (989, '2020-05-28') RETURNING \"id\"","database_type":"postgres","server_version":110006}},{"id":752302,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752301,"elapsed":0.000967},{"id":752303,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"RELEASE SAVEPOINT active_record_2","database_type":"postgres","server_version":110006}},{"id":752304,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752303,"elapsed":0.000751},{"id":752305,"event":"return","defined_class":"User","method_id":"create_visit_record!","path":"app/models/user.rb","lineno":671,"static":false,"thread_id":70097708498960,"parent_id":752294,"elapsed":0.022035,"return_value":{"class":"UserVisit","value":"#<UserVisit:0x00007f81d57b7858>","object_id":70097804573740}},{"id":752306,"event":"return","defined_class":"User","method_id":"update_visit_record!","path":"app/models/user.rb","lineno":680,"static":false,"thread_id":70097708498960,"parent_id":752289,"elapsed":0.027229,"return_value":{"class":"UserVisit","value":"#<UserVisit:0x00007f81d57b7858>","object_id":70097804573740}},{"id":752307,"event":"call","defined_class":"User","method_id":"seen_before?","path":"app/models/user.rb","lineno":667,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"User","object_id":70097817224740,"value":"#<User:0x00007f81d6fd8c48>"}},{"id":752308,"event":"return","defined_class":"User","method_id":"seen_before?","path":"app/models/user.rb","lineno":667,"static":false,"thread_id":70097708498960,"parent_id":752307,"elapsed":1.9e-05},{"id":752309,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"UPDATE \"users\" SET \"last_seen_at\" = '2020-05-28 18:58:08.510154' WHERE \"users\".\"id\" = 989","database_type":"postgres","server_version":110006}},{"id":752310,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752309,"elapsed":0.001073},{"id":752311,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"UPDATE \"users\" SET \"first_seen_at\" = '2020-05-28 18:58:08.510154' WHERE \"users\".\"id\" = 989","database_type":"postgres","server_version":110006}},{"id":752312,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752311,"elapsed":0.001039},{"id":752313,"event":"return","defined_class":"User","method_id":"update_last_seen!","path":"app/models/user.rb","lineno":721,"static":false,"thread_id":70097708498960,"parent_id":752288,"elapsed":0.036758},{"id":752314,"event":"call","defined_class":"User","method_id":"update_ip_address!","path":"app/models/user.rb","lineno":715,"static":false,"thread_id":70097708498960,"parameters":[{"name":"new_ip_address","class":"String","object_id":70097817263480,"value":"127.0.0.1","kind":"req"}],"receiver":{"class":"User","object_id":70097817224740,"value":"#<User:0x00007f81d6fd8c48>"}},{"id":752315,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"UPDATE \"users\" SET \"ip_address\" = '127.0.0.1' WHERE \"users\".\"id\" = 989","database_type":"postgres","server_version":110006}},{"id":752316,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752315,"elapsed":0.001113},{"id":752317,"event":"return","defined_class":"User","method_id":"update_ip_address!","path":"app/models/user.rb","lineno":715,"static":false,"thread_id":70097708498960,"parent_id":752314,"elapsed":0.003817,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":752318,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752263,"elapsed":0.071184,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752319,"event":"return","defined_class":"ApplicationController","method_id":"guardian","path":"app/controllers/application_controller.rb","lineno":423,"static":false,"thread_id":70097708498960,"parent_id":752262,"elapsed":0.071314,"return_value":{"class":"Guardian","value":"#<Guardian:0x00007f81be1a00f8>","object_id":70097608441980}},{"id":752320,"event":"call","defined_class":"Guardian","method_id":"can_enable_safe_mode?","path":"lib/guardian.rb","lineno":149,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"Guardian","object_id":70097608441980,"value":"#<Guardian:0x00007f81be1a00f8>"}},{"id":752321,"event":"return","defined_class":"Guardian","method_id":"can_enable_safe_mode?","path":"lib/guardian.rb","lineno":149,"static":false,"thread_id":70097708498960,"parent_id":752320,"elapsed":9.0e-06,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":752322,"event":"return","defined_class":"ApplicationController","method_id":"resolve_safe_mode","path":"app/controllers/application_controller.rb","lineno":377,"static":false,"thread_id":70097708498960,"parent_id":752261,"elapsed":0.071554},{"id":752323,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752324,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752323,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752325,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"SELECT \"user_options\".* FROM \"user_options\" WHERE \"user_options\".\"user_id\" = 989 LIMIT 1","database_type":"postgres","server_version":110006}},{"id":752326,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752325,"elapsed":0.001033},{"id":752327,"event":"call","defined_class":"ApplicationController","method_id":"guardian","path":"app/controllers/application_controller.rb","lineno":423,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752328,"event":"return","defined_class":"ApplicationController","method_id":"guardian","path":"app/controllers/application_controller.rb","lineno":423,"static":false,"thread_id":70097708498960,"parent_id":752327,"elapsed":5.0e-06,"return_value":{"class":"Guardian","value":"#<Guardian:0x00007f81be1a00f8>","object_id":70097608441980}},{"id":752329,"event":"call","defined_class":"Guardian","method_id":"allow_themes?","path":"lib/guardian.rb","lineno":474,"static":false,"thread_id":70097708498960,"parameters":[{"name":"theme_ids","class":"Array","object_id":70097828335000,"value":"[]","kind":"req"},{"name":"include_preview","class":"NilClass","object_id":8,"value":null,"kind":"key"}],"receiver":{"class":"Guardian","object_id":70097608441980,"value":"#<Guardian:0x00007f81be1a00f8>"}},{"id":752330,"event":"return","defined_class":"Guardian","method_id":"allow_themes?","path":"lib/guardian.rb","lineno":474,"static":false,"thread_id":70097708498960,"parent_id":752329,"elapsed":3.0e-06,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":752331,"event":"return","defined_class":"ApplicationController","method_id":"handle_theme","path":"app/controllers/application_controller.rb","lineno":388,"static":false,"thread_id":70097708498960,"parent_id":752260,"elapsed":0.076518,"return_value":{"class":"Array","value":"[2]","object_id":70097828335000}},{"id":752332,"event":"call","defined_class":"ApplicationController","method_id":"set_current_user_for_logs","path":"app/controllers/application_controller.rb","lineno":294,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752333,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752334,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752333,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752335,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752336,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752335,"elapsed":2.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752337,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752338,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752337,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752339,"event":"return","defined_class":"ApplicationController","method_id":"set_current_user_for_logs","path":"app/controllers/application_controller.rb","lineno":294,"static":false,"thread_id":70097708498960,"parent_id":752332,"elapsed":0.000333,"return_value":{"class":"String","value":"users/search_users","object_id":70097828347660}},{"id":752340,"event":"call","defined_class":"ApplicationController","method_id":"clear_notifications","path":"app/controllers/application_controller.rb","lineno":302,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752341,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752342,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752341,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752343,"event":"return","defined_class":"ApplicationController","method_id":"clear_notifications","path":"app/controllers/application_controller.rb","lineno":302,"static":false,"thread_id":70097708498960,"parent_id":752340,"elapsed":0.000104},{"id":752344,"event":"call","defined_class":"ApplicationController","method_id":"set_locale","path":"app/controllers/application_controller.rb","lineno":328,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752345,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752346,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752345,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752347,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752348,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752347,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752349,"event":"call","defined_class":"User","method_id":"effective_locale","path":"app/models/user.rb","lineno":321,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"User","object_id":70097817224740,"value":"#<User:0x00007f81d6fd8c48>"}},{"id":752350,"event":"return","defined_class":"User","method_id":"effective_locale","path":"app/models/user.rb","lineno":321,"static":false,"thread_id":70097708498960,"parent_id":752349,"elapsed":1.0e-05,"return_value":{"class":"String","value":"en_US","object_id":70097724286060}},{"id":752351,"event":"call","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parameters":[{"name":"locale","class":"Symbol","object_id":70097724306540,"value":"en_US","kind":"req"}],"receiver":{"class":"Class","object_id":70097569845280,"value":"LocaleSiteSetting"}},{"id":752352,"event":"return","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parent_id":752351,"elapsed":4.0e-06,"return_value":{"class":"Symbol","value":"en","object_id":3894428}},{"id":752353,"event":"call","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parameters":[{"name":"locale","class":"Symbol","object_id":3894428,"value":"en","kind":"req"}],"receiver":{"class":"Class","object_id":70097569845280,"value":"LocaleSiteSetting"}},{"id":752354,"event":"return","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parent_id":752353,"elapsed":9.0e-06},{"id":752355,"event":"call","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parameters":[{"name":"locale","class":"Symbol","object_id":70097724306540,"value":"en_US","kind":"req"}],"receiver":{"class":"Class","object_id":70097569845280,"value":"LocaleSiteSetting"}},{"id":752356,"event":"return","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parent_id":752355,"elapsed":3.0e-06,"return_value":{"class":"Symbol","value":"en","object_id":3894428}},{"id":752357,"event":"call","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parameters":[{"name":"locale","class":"Symbol","object_id":3894428,"value":"en","kind":"req"}],"receiver":{"class":"Class","object_id":70097569845280,"value":"LocaleSiteSetting"}},{"id":752358,"event":"return","defined_class":"LocaleSiteSetting","method_id":"fallback_locale","path":"app/models/locale_site_setting.rb","lineno":62,"static":true,"thread_id":70097708498960,"parent_id":752357,"elapsed":6.0e-06},{"id":752359,"event":"return","defined_class":"ApplicationController","method_id":"set_locale","path":"app/controllers/application_controller.rb","lineno":328,"static":false,"thread_id":70097708498960,"parent_id":752344,"elapsed":0.000657,"return_value":{"class":"Array","value":"[:en_US, :en]","object_id":70097612737620}},{"id":752360,"event":"call","defined_class":"ApplicationController","method_id":"set_mobile_view","path":"app/controllers/application_controller.rb","lineno":368,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752361,"event":"return","defined_class":"ApplicationController","method_id":"set_mobile_view","path":"app/controllers/application_controller.rb","lineno":368,"static":false,"thread_id":70097708498960,"parent_id":752360,"elapsed":6.0e-06},{"id":752362,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"is_api?","path":"lib/auth/default_current_user_provider.rb","lineno":271,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752363,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752364,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752363,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752365,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"is_api?","path":"lib/auth/default_current_user_provider.rb","lineno":271,"static":false,"thread_id":70097708498960,"parent_id":752362,"elapsed":9.0e-05},{"id":752366,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752367,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752366,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752368,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752369,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752368,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752370,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752371,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752370,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752372,"event":"call","defined_class":"ApplicationController","method_id":"requires_login_arg","path":"app/controllers/application_controller.rb","lineno":669,"static":true,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"Class","object_id":70097775906280,"value":"UsersController"}},{"id":752373,"event":"return","defined_class":"ApplicationController","method_id":"requires_login_arg","path":"app/controllers/application_controller.rb","lineno":669,"static":true,"thread_id":70097708498960,"parent_id":752372,"elapsed":3.0e-06,"return_value":{"class":"Hash","value":"{:only=>[:username, :update, :user_preferences_redirect, :upload_user_image, :pick_avatar, :destroy_","object_id":70097777085280}},{"id":752374,"event":"call","defined_class":"ApplicationController","method_id":"preload_json","path":"app/controllers/application_controller.rb","lineno":352,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752375,"event":"return","defined_class":"ApplicationController","method_id":"preload_json","path":"app/controllers/application_controller.rb","lineno":352,"static":false,"thread_id":70097708498960,"parent_id":752374,"elapsed":7.0e-06},{"id":752376,"event":"call","defined_class":"UsersController","method_id":"search_users","path":"app/controllers/users_controller.rb","lineno":923,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752377,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752378,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752377,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752379,"event":"call","defined_class":"UserSearch","method_id":"search","path":"app/models/user_search.rb","lineno":169,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UserSearch","object_id":70097828387740,"value":"#<UserSearch:0x00007f81d8523738>"}},{"id":752380,"event":"call","defined_class":"UserSearch","method_id":"search_ids","path":"app/models/user_search.rb","lineno":71,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UserSearch","object_id":70097828387740,"value":"#<UserSearch:0x00007f81d8523738>"}},{"id":752381,"event":"call","defined_class":"UserSearch","method_id":"scoped_users","path":"app/models/user_search.rb","lineno":24,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UserSearch","object_id":70097828387740,"value":"#<UserSearch:0x00007f81d8523738>"}},{"id":752382,"event":"call","defined_class":"Roleable","method_id":"staff?","path":"app/models/concerns/roleable.rb","lineno":13,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"User","object_id":70097817224740,"value":"#<User:0x00007f81d6fd8c48>"}},{"id":752383,"event":"return","defined_class":"Roleable","method_id":"staff?","path":"app/models/concerns/roleable.rb","lineno":13,"static":false,"thread_id":70097708498960,"parent_id":752382,"elapsed":1.4e-05},{"id":752384,"event":"return","defined_class":"UserSearch","method_id":"scoped_users","path":"app/models/user_search.rb","lineno":24,"static":false,"thread_id":70097708498960,"parent_id":752381,"elapsed":0.000344,"return_value":{"class":"ActiveRecord::Relation","value":"#<User::ActiveRecord_Relation:0x00007f81d852a628>","object_id":70097828401940}},{"id":752385,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"SELECT \"users\".\"id\" FROM \"users\" WHERE \"users\".\"active\" = TRUE AND \"users\".\"staged\" = FALSE AND (suspended_till IS NULL OR suspended_till <= '2020-05-28 18:58:08.558851') AND \"users\".\"username_lower\" = 'a' LIMIT 20","database_type":"postgres","server_version":110006}},{"id":752386,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752385,"elapsed":0.001141},{"id":752387,"event":"call","defined_class":"UserSearch","method_id":"filtered_by_term_users","path":"app/models/user_search.rb","lineno":51,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UserSearch","object_id":70097828387740,"value":"#<UserSearch:0x00007f81d8523738>"}},{"id":752388,"event":"call","defined_class":"UserSearch","method_id":"scoped_users","path":"app/models/user_search.rb","lineno":24,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UserSearch","object_id":70097828387740,"value":"#<UserSearch:0x00007f81d8523738>"}},{"id":752389,"event":"call","defined_class":"Roleable","method_id":"staff?","path":"app/models/concerns/roleable.rb","lineno":13,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"User","object_id":70097817224740,"value":"#<User:0x00007f81d6fd8c48>"}},{"id":752390,"event":"return","defined_class":"Roleable","method_id":"staff?","path":"app/models/concerns/roleable.rb","lineno":13,"static":false,"thread_id":70097708498960,"parent_id":752389,"elapsed":8.0e-06},{"id":752391,"event":"return","defined_class":"UserSearch","method_id":"scoped_users","path":"app/models/user_search.rb","lineno":24,"static":false,"thread_id":70097708498960,"parent_id":752388,"elapsed":0.000291,"return_value":{"class":"ActiveRecord::Relation","value":"#<User::ActiveRecord_Relation:0x00007f81d85939e8>","object_id":70097828617460}},{"id":752392,"event":"return","defined_class":"UserSearch","method_id":"filtered_by_term_users","path":"app/models/user_search.rb","lineno":51,"static":false,"thread_id":70097708498960,"parent_id":752387,"elapsed":0.001368,"return_value":{"class":"ActiveRecord::Relation","value":"#<User::ActiveRecord_Relation:0x00007f81d8591f30>","object_id":70097828614040}},{"id":752393,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"SELECT \"users\".\"id\" FROM \"users\" LEFT OUTER JOIN \"user_search_data\" ON \"user_search_data\".\"user_id\" = \"users\".\"id\" WHERE \"users\".\"active\" = TRUE AND \"users\".\"staged\" = FALSE AND (suspended_till IS NULL OR suspended_till <= '2020-05-28 18:58:08.563169') AND (user_search_data.search_data @@ TO_TSQUERY('simple', '''a'':*')) ORDER BY CASE WHEN username_lower LIKE 'a%' THEN 0 ELSE 1 END ASC, last_seen_at DESC LIMIT 20","database_type":"postgres","server_version":110006}},{"id":752394,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752393,"elapsed":0.001158},{"id":752395,"event":"return","defined_class":"UserSearch","method_id":"search_ids","path":"app/models/user_search.rb","lineno":71,"static":false,"thread_id":70097708498960,"parent_id":752380,"elapsed":0.009741,"return_value":{"class":"Array","value":"[]","object_id":70097613331360}},{"id":752396,"event":"return","defined_class":"UserSearch","method_id":"search","path":"app/models/user_search.rb","lineno":169,"static":false,"thread_id":70097708498960,"parent_id":752379,"elapsed":0.009901,"return_value":{"class":"ActiveRecord::Relation","value":"#<User::ActiveRecord_Relation:0x00007f81beaf2a70>","object_id":70097613329720}},{"id":752397,"event":"call","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":136,"static":false,"thread_id":70097708498960,"sql_query":{"sql":"SELECT \"users\".* FROM \"users\" WHERE (0=1)","database_type":"postgres","server_version":110006}},{"id":752398,"event":"return","defined_class":"AppMap::Rails::SQLHandler","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/sql_handler.rb","lineno":138,"static":false,"thread_id":70097708498960,"parent_id":752397,"elapsed":0.000957},{"id":752399,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752400,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752399,"elapsed":5.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752401,"event":"return","defined_class":"UsersController","method_id":"search_users","path":"app/controllers/users_controller.rb","lineno":923,"static":false,"thread_id":70097708498960,"parent_id":752376,"elapsed":0.014121,"return_value":{"class":"String","value":"{\"users\":[]}","object_id":70097588205100}},{"id":752402,"event":"call","defined_class":"ApplicationController","method_id":"conditionally_allow_site_embedding","path":"app/controllers/application_controller.rb","lineno":92,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752403,"event":"return","defined_class":"ApplicationController","method_id":"conditionally_allow_site_embedding","path":"app/controllers/application_controller.rb","lineno":92,"static":false,"thread_id":70097708498960,"parent_id":752402,"elapsed":6.0e-06},{"id":752404,"event":"call","defined_class":"ApplicationController","method_id":"dont_cache_page","path":"app/controllers/application_controller.rb","lineno":85,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752405,"event":"return","defined_class":"ApplicationController","method_id":"dont_cache_page","path":"app/controllers/application_controller.rb","lineno":85,"static":false,"thread_id":70097708498960,"parent_id":752404,"elapsed":5.0e-06,"return_value":{"class":"Array","value":"[\"no-store\"]","object_id":70097588222340}},{"id":752406,"event":"call","defined_class":"ApplicationController","method_id":"perform_refresh_session","path":"app/controllers/application_controller.rb","lineno":75,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"UsersController","object_id":70097803832240,"value":"#<UsersController:0x00007f81d564d760>"}},{"id":752407,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752408,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752407,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752409,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"refresh_session","path":"lib/auth/default_current_user_provider.rb","lineno":173,"static":false,"thread_id":70097708498960,"parameters":[{"name":"user","class":"User","object_id":70097817224740,"value":"#<User:0x00007f81d6fd8c48>","kind":"req"},{"name":"session","class":"ActionDispatch::Request::Session","object_id":70097803598100,"value":"#<ActionDispatch::Request::Session:0x00007f81d55db228>","kind":"req"},{"name":"cookies","class":"ActionDispatch::Cookies::CookieJar","object_id":70097828335280,"value":"#<ActionDispatch::Cookies::CookieJar:0x00007f81d8509d60>","kind":"req"}],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752410,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"is_api?","path":"lib/auth/default_current_user_provider.rb","lineno":271,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752411,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752412,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752411,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752413,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"is_api?","path":"lib/auth/default_current_user_provider.rb","lineno":271,"static":false,"thread_id":70097708498960,"parent_id":752410,"elapsed":8.8e-05},{"id":752414,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"is_user_api?","path":"lib/auth/default_current_user_provider.rb","lineno":276,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752415,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097804392120,"value":"#<TestCurrentUserProvider:0x00007f81d575ed70>"}},{"id":752416,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"current_user","path":"lib/auth/default_current_user_provider.rb","lineno":61,"static":false,"thread_id":70097708498960,"parent_id":752415,"elapsed":3.0e-06,"return_value":{"class":"User","value":"#<User:0x00007f81d6fd8c48>","object_id":70097817224740}},{"id":752417,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"is_user_api?","path":"lib/auth/default_current_user_provider.rb","lineno":276,"static":false,"thread_id":70097708498960,"parent_id":752414,"elapsed":8.7e-05},{"id":752418,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"refresh_session","path":"lib/auth/default_current_user_provider.rb","lineno":173,"static":false,"thread_id":70097708498960,"parent_id":752409,"elapsed":0.000402},{"id":752419,"event":"return","defined_class":"ApplicationController","method_id":"perform_refresh_session","path":"app/controllers/application_controller.rb","lineno":75,"static":false,"thread_id":70097708498960,"parent_id":752406,"elapsed":0.000595},{"id":752420,"event":"return","defined_class":"AppMap::Rails::ActionHandler::HTTPServerResponse","method_id":"call","path":"/Users/kgilpin/source/appland/appmap-ruby/lib/appmap/rails/action_handler.rb","lineno":85,"static":false,"thread_id":70097708498960,"parent_id":752259,"elapsed":0.094907,"http_server_response":{"status":200}},{"id":752421,"event":"call","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"has_auth_cookie?","path":"lib/auth/default_current_user_provider.rb","lineno":281,"static":false,"thread_id":70097708498960,"parameters":[],"receiver":{"class":"TestCurrentUserProvider","object_id":70097588286420,"value":"#<TestCurrentUserProvider:0x00007f81bbb2e7a8>"}},{"id":752422,"event":"return","defined_class":"Auth::DefaultCurrentUserProvider","method_id":"has_auth_cookie?","path":"lib/auth/default_current_user_provider.rb","lineno":281,"static":false,"thread_id":70097708498960,"parent_id":752421,"elapsed":8.0e-06,"return_value":{"class":"TrueClass","value":"true","object_id":20}},{"id":752423,"event":"call","defined_class":"ApplicationRequest(id: integer, date: date, req_type: integer, count: integer)","method_id":"increment!","path":"app/models/application_request.rb","lineno":26,"static":true,"thread_id":70097708498960,"parameters":[{"name":"type","class":"Symbol","object_id":13040028,"value":"http_total","kind":"req"},{"name":"opts","class":"NilClass","object_id":8,"value":null,"kind":"opt"}],"receiver":{"class":"Class","object_id":70097802320860,"value":"ApplicationRequest"}},{"id":752424,"event":"return","defined_class":"ApplicationRequest(id: integer, date: date, req_type: integer, count: integer)","method_id":"increment!","path":"app/models/application_request.rb","lineno":26,"static":true,"thread_id":70097708498960,"parent_id":752423,"elapsed":4.0e-06},{"id":752425,"event":"call","defined_class":"ApplicationRequest(id: integer, date: date, req_type: integer, count: integer)","method_id":"increment!","path":"app/models/application_request.rb","lineno":26,"static":true,"thread_id":70097708498960,"parameters":[{"name":"type","class":"Symbol","object_id":13041948,"value":"http_2xx","kind":"req"},{"name":"opts","class":"NilClass","object_id":8,"value":null,"kind":"opt"}],"receiver":{"class":"Class","object_id":70097802320860,"value":"ApplicationRequest"}},{"id":752426,"event":"return","defined_class":"ApplicationRequest(id: integer, date: date, req_type: integer, count: integer)","method_id":"increment!","path":"app/models/application_request.rb","lineno":26,"static":true,"thread_id":70097708498960,"parent_id":752425,"elapsed":3.0e-06}]}